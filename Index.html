<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>A Quiet Valentine ‚Äî for Blub</title>
  <meta name="description" content="A quiet, artsy Valentine film ‚Äî untuk Blub." />

  <!-- 2 fonts only: 1 serif + 1 script accent -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400,600,700&family=Allura&display=swap" rel="stylesheet">

  <style>
    :root{
      --velvet:#2b0717;
      --deep:#12050c;
      --rose:#7A1E3A;
      --blush:#F6C1D8;
      --champ:#F3E5C8;
      --sage:#9DAF9D;
      --ink:#2A1B23;

      --paper: rgba(255,255,255,.92);
      --paper2: rgba(255,255,255,.78);
      --stroke: rgba(42,27,35,.14);
      --shadow: 0 26px 100px rgba(0,0,0,.22);
      --ease: cubic-bezier(.2,.9,.2,1);

      --r: 28px;
      --r2: 36px;

      --serif: "Fraunces", ui-serif, Georgia, serif;
      --script: "Allura", "Snell Roundhand", "Apple Chancery", cursive;
      --ui: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      overflow:hidden;
      color: rgba(255,255,255,.92);
      background: linear-gradient(160deg, #3a0820, var(--deep));
      -webkit-tap-highlight-color: transparent;
      font-family: var(--serif);
    }

    /* ===== Background watercolor wash ===== */
    .bg{
      position:fixed; inset:0; z-index:0;
      background:
        radial-gradient(1200px 900px at 18% 20%, rgba(246,193,216,.28), transparent 62%),
        radial-gradient(1000px 760px at 84% 22%, rgba(243,229,200,.20), transparent 64%),
        radial-gradient(1000px 760px at 55% 110%, rgba(157,175,157,.14), transparent 64%),
        linear-gradient(160deg, #3a0820, var(--deep));
    }
    .bg:before{
      content:"";
      position:absolute; inset:-10%;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='800'%3E%3Cdefs%3E%3Cfilter id='w'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.009' numOctaves='2' seed='9'/%3E%3CfeDisplacementMap in='SourceGraphic' scale='30'/%3E%3C/filter%3E%3C/defs%3E%3Crect width='1200' height='800' fill='%23F6C1D8' opacity='.18' filter='url(%23w)'/%3E%3Crect width='1200' height='800' fill='%23F3E5C8' opacity='.14' filter='url(%23w)'/%3E%3Crect width='1200' height='800' fill='%239DAF9D' opacity='.10' filter='url(%23w)'/%3E%3C/svg%3E");
      background-size:cover;
      background-position:center;
      opacity:.55;
      filter: blur(.6px);
    }

    .grain{
      position:fixed; inset:0; z-index:1; pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      opacity:.07;
      mix-blend-mode: overlay;
    }

    canvas#petals{position:fixed; inset:0; z-index:2; pointer-events:none; opacity:.65}

    /* ===== Stage & panel ===== */
    .stage{
      position:relative; z-index:10;
      height:100%;
      display:grid;
      place-items:center;
      padding:18px;
    }

    .panel{
      width:min(980px, 100%);
      height:min(700px, calc(100vh - 36px));
      border-radius: var(--r2);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
      position:relative;
    }

    .paper{
      position:absolute; inset:14px;
      border-radius: calc(var(--r2) - 10px);
      background: var(--paper);
      color: rgba(42,27,35,.88);
      border:1px solid rgba(42,27,35,.10);
      overflow:hidden;
    }
    .paper:before{
      content:"";
      position:absolute; inset:-12%;
      background:
        radial-gradient(700px 420px at 22% 24%, rgba(246,193,216,var(--t1,.18)), transparent 62%),
        radial-gradient(700px 420px at 82% 22%, rgba(243,229,200,var(--t2,.14)), transparent 64%),
        radial-gradient(820px 520px at 55% 120%, rgba(157,175,157,var(--t3,.10)), transparent 64%);
      filter: blur(10px);
      opacity:.9;
      transform: scale(1.02);
    }
    .paper:after{
      content:"";
      position:absolute; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.95' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.14'/%3E%3C/svg%3E");
      opacity:.28;
      mix-blend-mode:multiply;
      pointer-events:none;
    }
    .paper > *{position:relative; z-index:2}

    /* ===== Header ribbon ===== */
    .ribbon{
      position:absolute; top:18px; left:18px; right:18px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      font-family: var(--ui);
      font-weight: 900;
      letter-spacing:.2px;
      color: rgba(42,27,35,.68);
    }
    .tag{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(42,27,35,.12);
      background: rgba(255,255,255,.72);
      box-shadow: 0 12px 26px rgba(0,0,0,.06);
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: rgba(122,30,58,.92);
    }
    .chap{
      padding:10px 12px;
      border-radius:999px;
      border:1px dashed rgba(42,27,35,.18);
      background: rgba(255,255,255,.56);
      opacity:.8;
    }

    .view{
      position:absolute; inset:72px 18px 18px 18px;
      border-radius: calc(var(--r2) - 14px);
      overflow:hidden;
    }

    /* ===== Scene ===== */
    .scene{
      position:absolute; inset:0;
      padding: 20px 18px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      opacity:0;
      transform: translateY(10px);
      transition: opacity 700ms var(--ease), transform 700ms var(--ease);
      pointer-events:none;
    }
    .scene.active{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    h1{
      margin:0 0 10px;
      font-family: var(--serif);
      font-weight: 700;
      font-size: clamp(30px, 4.4vw, 54px);
      letter-spacing:-.4px;
      color: rgba(42,27,35,.92);
      line-height:1.05;
    }
    h2{
      margin:0 0 10px;
      font-family: var(--serif);
      font-weight: 700;
      font-size: clamp(22px, 3.0vw, 34px);
      letter-spacing:-.2px;
      color: rgba(42,27,35,.90);
    }
    p{
      margin: 8px 0 0;
      max-width: 62ch;
      font-family: var(--serif);
      font-weight: 500;
      font-size: clamp(16px, 2.0vw, 21px);
      line-height:1.85;
      color: rgba(42,27,35,.82);
    }
    .script{
      font-family: var(--script);
      font-size: clamp(34px, 5.0vw, 62px);
      color: rgba(122,30,58,.92);
      margin-top: 10px;
      line-height:1;
    }
    .quiet{
      margin-top: 14px;
      font-family: var(--ui);
      font-weight: 800;
      font-size: 12px;
      color: rgba(42,27,35,.54);
    }

    .row{
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:center;
      margin-top: 18px;
      font-family: var(--ui);
    }
    .btn{
      border:1px solid rgba(42,27,35,.14);
      background: rgba(255,255,255,.82);
      color: rgba(42,27,35,.90);
      padding: 12px 16px;
      border-radius: 999px;
      font-weight: 950;
      cursor:pointer;
      user-select:none;
      transition: transform 140ms var(--ease), background 140ms var(--ease), opacity 140ms var(--ease);
      box-shadow: 0 12px 30px rgba(0,0,0,.06);
    }
    .btn:hover{transform: translateY(-1px)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(246,193,216,.95), rgba(243,229,200,.86));
      border-color: rgba(122,30,58,.16);
    }
    .btn.locked{
      opacity:.55;
      cursor:not-allowed;
      transform:none !important;
    }

    /* ===== Photo carousel (must-swipe) ===== */
    .carouselWrap{
      width:100%;
      max-width: 900px;
      margin-top: 10px;
    }
    .carousel{
      width:100%;
      display:flex;
      gap:14px;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      padding: 6px 6px 14px;
      -webkit-overflow-scrolling: touch;
    }
    .carousel::-webkit-scrollbar{display:none}
    .slide{
      scroll-snap-align:center;
      flex: 0 0 min(78%, 420px);
      height: 320px;
      border-radius: 22px;
      border:1px solid rgba(42,27,35,.14);
      background: rgba(255,255,255,.72);
      box-shadow: 0 18px 46px rgba(0,0,0,.12);
      overflow:hidden;
      position:relative;
      transform: rotate(var(--rot, -1.2deg));
    }
    .slide:nth-child(even){ transform: rotate(var(--rot2, 1.2deg)); }
    .slide img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
      filter: saturate(1.02) contrast(1.02);
    }
    .pager{
      display:flex; gap:6px; justify-content:center;
      margin-top:10px;
    }
    .dotp{
      width:8px; height:8px; border-radius:999px;
      border:1px solid rgba(42,27,35,.20);
      background: rgba(42,27,35,.10);
      opacity:.6;
    }
    .dotp.on{
      background: rgba(122,30,58,.42);
      border-color: rgba(122,30,58,.28);
      opacity:1;
    }
    .hint{
      font-family: var(--ui);
      font-weight: 900;
      font-size: 12px;
      color: rgba(42,27,35,.56);
      margin-top: 10px;
    }

    /* ===== Reveal lines (cinematic) ===== */
    .lines{
      margin-top: 6px;
      display:grid;
      gap: 8px;
      max-width: 72ch;
    }
    .line{
      opacity:0;
      transform: translateY(6px);
      transition: opacity 600ms var(--ease), transform 600ms var(--ease);
      padding: 0 6px;
    }
    .line.show{
      opacity:1;
      transform: translateY(0);
    }

    /* ===== Props ===== */
    .propRow{
      display:flex; gap:14px; align-items:center; justify-content:center;
      margin-top: 14px;
      flex-wrap:wrap;
      font-family: var(--ui);
    }
    .prop{
      border:1px solid rgba(42,27,35,.14);
      background: rgba(255,255,255,.78);
      border-radius: 22px;
      padding: 12px 14px;
      font-weight: 950;
      color: rgba(42,27,35,.80);
      cursor:pointer;
      user-select:none;
      box-shadow: 0 12px 28px rgba(0,0,0,.06);
      display:inline-flex; gap:10px; align-items:center;
    }
    .prop small{opacity:.70;font-weight:900}
    .counter{
      min-width: 62px;
      text-align:center;
      border:1px dashed rgba(42,27,35,.20);
      background: rgba(255,255,255,.55);
      border-radius: 14px;
      padding:6px 10px;
      font-size: 12px;
      font-family: var(--ui);
      font-weight: 950;
      color: rgba(42,27,35,.72);
    }

    /* ===== Envelope ===== */
    .envelopeWrap{
      display:grid;
      place-items:center;
      gap:14px;
      margin-top: 10px;
    }
    .envelope{
      width: 270px;
      height: 176px;
      background: rgba(243,229,200,.92);
      border:1px solid rgba(42,27,35,.18);
      border-radius: 12px;
      position:relative;
      box-shadow: 0 18px 50px rgba(0,0,0,.12);
      cursor:pointer;
      user-select:none;
      overflow:hidden;
    }
    .envFlap{
      position:absolute; inset:0;
      background: rgba(122,30,58,.88);
      clip-path: polygon(0 0, 50% 62%, 100% 0, 100% 0, 0 0);
      transform-origin: top;
      transition: transform 900ms var(--ease);
    }
    .envBody{
      position:absolute; inset:0;
      background:
        linear-gradient(135deg, rgba(246,193,216,.18), rgba(243,229,200,.10)),
        rgba(243,229,200,.92);
    }
    .wax{
      position:absolute;
      left:50%; top:58%;
      transform: translate(-50%,-50%);
      width: 54px; height: 54px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), transparent 55%), rgba(122,30,58,.92);
      border: 1px solid rgba(42,27,35,.16);
      box-shadow: 0 10px 26px rgba(0,0,0,.14);
      display:grid; place-items:center;
      color: rgba(255,255,255,.92);
      font-family: var(--ui);
      font-weight: 950;
      letter-spacing:.6px;
    }
    .envelope.open .envFlap{ transform: rotateX(180deg); }
    .letter{
      display:none;
      max-width: 62ch;
      border-radius: 22px;
      padding: 14px 16px;
      border:1px solid rgba(42,27,35,.14);
      background: rgba(255,255,255,.84);
      box-shadow: 0 14px 40px rgba(0,0,0,.08);
      text-align:center;
    }
    .letter.show{display:block}

    /* toast */
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      padding:10px 12px;
      border-radius:999px;
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.16);
      color: rgba(255,255,255,.90);
      font-family: var(--ui);
      font-weight: 950;
      display:none;
      z-index:80;
      backdrop-filter: blur(12px);
    }
    .toast.show{display:block; animation:pop 180ms var(--ease)}
    @keyframes pop{from{transform:translateX(-50%) translateY(8px);opacity:0}to{transform:translateX(-50%) translateY(0);opacity:1}}

    @media (max-width:520px){
      .panel{height: calc(100vh - 22px)}
      .paper{inset:12px}
      .view{inset:70px 12px 12px 12px}
      .ribbon{left:12px; right:12px}
      .slide{height: 280px}
    }
  </style>
</head>

<body>
  <div class="bg"></div>
  <div class="grain"></div>
  <canvas id="petals"></canvas>

  <div class="stage">
    <div class="panel">
      <div class="paper" id="paper">
        <div class="ribbon">
          <div class="tag"><span class="dot"></span> <span id="tagLine">Welcome</span></div>
          <div class="chap" id="chap">0 / 13</div>
        </div>

        <div class="view">

          <!-- 0: WELCOME -->
          <section class="scene active" data-i="0">
            <h1>Hi! Selamat Valentine, Nduk ‚ù§Ô∏è</h1>
            <p>Pelan-pelan ya bacanya, jangan terburu nggih sayangku ü§ó</p>
            <div class="row">
              <button class="btn primary" id="enter">Masuk üíò</button>
            </div>
        <div class="quiet">(~With heart : Mirza)</div>
          </section>

          <!-- 1: CH1 GALLERY -->
          <section class="scene" data-i="1">
            <h2>Aku suka kamu yang nempel.</h2>
            <div class="carouselWrap">
              <div class="carousel" id="car1"></div>
              <div class="pager" id="pg1"></div>
              <div class="hint">Swipe minimal 1x dulu ya.</div>
            </div>
            <div class="row">
              <button class="btn primary locked" id="to2">Lanjut üíò</button>
            </div>
          </section>

          <!-- 2: CH1 TEXT -->
          <section class="scene" data-i="2">
            <h2>Tau ngga kelihat sepele tapi memorable‚Ä¶</h2>
            <div class="lines" id="l1">
              <div class="line">Kadang kamu masuk kamar‚Ä¶</div>
              <div class="line">guling-guling deket aku.</div>
              <div class="line">Aku sok cuek. Sok diem.</div>
              <div class="line">Padahal dalam hati‚Ä¶</div>
              <div class="line"><span class="script">tentrem</span>  banget ada kamu, walaupun kamu nggak ngapa-ngapain.</div>
            </div>
            <div class="row">
              <button class="btn primary locked" id="to3">Lanjut üíò</button>
            </div>
          </section>

          <!-- 3: CH2 GALLERY -->
          <section class="scene" data-i="3">
            <h2>Selalu tertarik sama pilihanku.</h2>
            <div class="carouselWrap">
              <div class="carousel" id="car2"></div>
              <div class="pager" id="pg2"></div>
              <div class="hint">Swipe minimal 1x dulu ya.</div>
            </div>
            <div class="row">
              <button class="btn primary locked" id="to4">Lanjut üíò</button>
            </div>
          </section>

          <!-- 4: CH2 TEXT -->
          <section class="scene" data-i="4">
            <h2>Kamu lihat perlahan.. kamu amati.. ‚Ä¶</h2>
            <p>Dalam hati üë© : "Kayanya makanan Mirza Lezat".</p>
            <p>Mata kamu mulai berubah.</p>
            <p>üë© : "Ihhh kok enak?!", terus bilang.</p>
            <div class="script" id="pengenWord"></div>
            <p id="huft" style="display:none"> üë® : "hehe‚Ä¶ monggo"</p>
            <div class="row">
              <button class="btn primary locked" id="to5">Lanjut üíò</button>
            </div>
          </section>

          <!-- 5: CH3 GALLERY -->
          <section class="scene" data-i="5">
            <h2>"Blub sayang... Buka Nduk..."</h2>
            <div class="carouselWrap">
              <div class="carousel" id="car3"></div>
              <div class="pager" id="pg3"></div>
              <div class="hint">Swipe minimal 1x dulu ya.</div>
            </div>
            <div class="row">
              <button class="btn primary locked" id="to6">Lanjut üíò</button>
            </div>
          </section>

          <!-- 6: CH3 TEXT (tok tok) -->
          <section class="scene" data-i="6">
            <h2>Pintu itu‚Ä¶</h2>
            <p>"Ceklek ceklek", jujur ini bunyi bikin deg"an üòó .</p>
            <p>Soalnya kamu nda sedih. Akhirnya, tok.. tok.. nduk sayang buka</p>

            <div class="propRow">
              <div class="prop" id="knock">‚úä <span>tok tok</span> <small>(3x)</small></div>
              <div class="counter" id="knockCount">0 / 3</div>
            </div>

            <div class="lines" id="doorLines" style="margin-top:14px">
              <div class="line">Lama banget kamu bukanya.</div>
              <div class="line">Sampai aku ngemper di depan pintu‚Ä¶ wkwk.</div>
              <div class="line">Dan anehnya‚Ä¶ aku nggak kesel.</div>
              <div class="line">Karena ujungnya kamu aku pangku, aku cup cup kaya maria waktu nangis ‚ò∫Ô∏è.</div>
            </div>

            <div class="row">
              <button class="btn primary locked" id="to7">Lanjut üíò</button>
            </div>
          </section>

          <!-- 7: CH4 GALLERY -->
          <section class="scene" data-i="7">
            <h2> Side eye üßê.</h2>
            <div class="carouselWrap">
              <div class="carousel" id="car4"></div>
              <div class="pager" id="pg4"></div>
              <div class="hint">Swipe minimal 1x dulu ya.</div>
            </div>
            <div class="row">
              <button class="btn primary locked" id="to8">Lanjut üíò</button>
            </div>
          </section>

          <!-- 8: CH4 TEXT (tap eye) -->
          <section class="scene" data-i="8">
            <h2>Di mall itu‚Ä¶</h2>
            <p>Kamu kira aku liatin cewe lain.</p>
            <p>Padahal aku cuma bengong üò≠ </p>

            <div class="propRow">
              <div class="prop" id="tapEye">üëÄ <span>tap</span> <small>(sekali)</small></div>
              <div class="counter" id="eyeDone">belum</div>
            </div>

            <div class="lines" id="mallLines" style="margin-top:14px">
              <div class="line"> Zuzurly, jadi was - was ya bun. Tapi cara kamu ngomongnya bikin aku ngerasa‚Ä¶</div>
              <div class="line"><b>kamu peduli.</b> sama aku, maafin aku yah üôè.</div>
            </div>

            <div class="row">
              <button class="btn primary locked" id="to9">Lanjut üíò</button>
            </div>
          </section>

          <!-- 9: CH5 GALLERY -->
          <section class="scene" data-i="9">
            <h2>Aku takut kehilangan kamu.</h2>
            <div class="carouselWrap">
              <div class="carousel" id="car5"></div>
              <div class="pager" id="pg5"></div>
              <div class="hint">Swipe minimal 1x dulu ya.</div>
            </div>
            <div class="row">
              <button class="btn primary locked" id="to10">Lanjut üíò</button>
            </div>
          </section>

          <!-- 10: CH5 TEXT (hold 2s) -->
          <section class="scene" data-i="10">
            <h2>Aku serius di sini.</h2>
            <div class="lines" id="fearLines">
              <div class="line">Aku takut kalau kamu lagi sedih dan sendirian, di kamar. itu berat banget buat aku.</div>
              <div class="line">Aku takut kamu ngebut waktu lagi banyak pikiran.</div>
              <div class="line">Aku nggak pengen kehilangan kamu.</div>
            </div>

            <div class="propRow" style="margin-top:14px">
              <div class="prop" id="holdSafe">ü´∂ <span>tahan 2 detik</span></div>
              <div class="counter" id="holdState">tahan‚Ä¶</div>
            </div>

            <div class="lines" id="safeLine" style="margin-top:14px">
              <div class="line">Kalau kamu lagi pengen nangis di luar‚Ä¶ kabarin dulu ya.</div>
              <div class="line">Kita cari tempat. Kita beresin bareng-bareng. Pelan.</div>
            </div>

            <div class="row">
              <button class="btn primary locked" id="to11">Lanjut üíò</button>
            </div>
          </section>

          <!-- 11: CH6 GALLERY -->
          <section class="scene" data-i="11">
            <h2>Kita sudah di tahap ini.</h2>
            <div class="carouselWrap">
              <div class="carousel" id="car6"></div>
              <div class="pager" id="pg6"></div>
              <div class="hint">Swipe minimal 1x dulu ya.</div>
            </div>
            <div class="row">
              <button class="btn primary locked" id="to12">Lanjut üíò</button>
            </div>
          </section>

          <!-- 12: CH6 TEXT -->
          <section class="scene" data-i="12">
            <h2>Masih nggak nyangka‚Ä¶</h2>
            <div class="lines" id="engLines">
              <div class="line">Tentang tunangan‚Ä¶</div>
              <div class="line">aku masih nggak nyangka. Momen ini sudah kita lewati... yang aku pikir 4 - 5 tahun lagi baru datang .</div>
              <div class="line">Thanks for having me ‚ù§Ô∏è‚ù§Ô∏è.</div>
              <div class="line">Aku nggak janji sempurna.</div>
              <div class="line">Tapi aku janji akan selalu belajar menjadi dewasa.</div>
            </div>
            <div class="row">
              <button class="btn primary locked" id="to13">Buka üíå</button>
            </div>
          </section>

          <!-- 13: FINAL -->
          <section class="scene" data-i="13">
            <h2>Happy Valentine, <span class="script">Blub</span>.</h2>

            <div class="envelopeWrap">
              <div class="envelope" id="env">
                <div class="envBody"></div>
                <div class="envFlap"></div>
                <div class="wax">B</div>
              </div>

              <div class="letter" id="letter">
                <p style="margin:0">Happy Valentine, Blub üåπ</p>
                <p style="margin-top:10px">Terima kasih sudah tetap di sini.. tetap milih aku, tetap percaya sama aku. Walaupun nggak selalu gampang, kamu tetap ngebuktiin kalau kita bisa jalan bareng, pelan-pelan..</p>
                <p style="margin-top:10px"> Aku sayang kamu. Dan aku bangga punya kamu</p>
              </div>

              <div class="propRow" style="margin-top:10px">
                <div class="prop" id="flower">üå∏ <span>bunga</span> <small>(tap 7x)</small></div>
                <div class="counter" id="flowerCount">0 / 7</div>
              </div>

              <div class="row">
                <button class="btn" id="copyLink">Copy link üîó</button>
                <button class="btn primary" id="restart">Ulang ‚Ü©Ô∏é</button>
              </div>

              <div class="quiet">(nggak perlu banyak kata. cukup ini.)</div>
            </div>
          </section>

        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">OK</div>

  <script>
    /* ====================== CORE NAV ====================== */
    const $ = (q)=>document.querySelector(q);
    const $$ = (q)=>document.querySelectorAll(q);

    const scenes = [...$$(".scene")];
    const chap = $("#chap");
    const tagLine = $("#tagLine");
    const paper = $("#paper");
    const toast = $("#toast");

    function showToast(t){
      toast.textContent = t;
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 1100);
    }

    function setPaperTint(a,b,c){
      paper.style.setProperty("--t1", a);
      paper.style.setProperty("--t2", b);
      paper.style.setProperty("--t3", c);
    }

    const tags = [
      "Welcome",
      "Gallery ‚Äî nempel",
      "Text ‚Äî nempel",
      "Gallery ‚Äî pengen",
      "Text ‚Äî pengen",
      "Gallery ‚Äî pintu",
      "Text ‚Äî pintu",
      "Gallery ‚Äî mall",
      "Text ‚Äî mall",
      "Gallery ‚Äî pelan",
      "Text ‚Äî pelan",
      "Gallery ‚Äî tunangan",
      "Text ‚Äî tunangan",
      "Final letter"
    ];

    const tints = [
      [".22",".18",".12"],
      [".20",".12",".10"],
      [".20",".12",".10"],
      [".18",".16",".08"],
      [".18",".16",".08"],
      [".14",".10",".08"],
      [".14",".10",".08"],
      [".16",".12",".08"],
      [".16",".12",".08"],
      [".10",".08",".06"],
      [".10",".08",".06"],
      [".18",".14",".08"],
      [".18",".14",".08"],
      [".18",".14",".10"],
    ];

    let idx = 0;

    function go(n){
      scenes[idx].classList.remove("active");
      idx = n;
      scenes[idx].classList.add("active");

      chap.textContent = `${idx} / 13`;
      tagLine.textContent = tags[idx] || "A Quiet Valentine";
      setPaperTint(...tints[idx]);

      // per scene triggers
      if(idx === 2) startAutoReveal("#l1", "#to3");
      if(idx === 4) startPengenTyping();
      if(idx === 6) resetDoor();
      if(idx === 8) resetMall();
      if(idx === 10) resetSafeAndReveal();
      if(idx === 12) startAutoReveal("#engLines", "#to13");

      // keep top
      window.scrollTo(0,0);
    }

    function lock(btn){ btn.classList.add("locked"); }
    function unlock(btn){ btn.classList.remove("locked"); }

    /* ====================== LINE REVEAL ====================== */
    let revealTimer = null;
    function startAutoReveal(containerSel, unlockBtnSel){
      clearTimeout(revealTimer);
      const box = $(containerSel);
      if(!box) return;
      const lines = [...box.querySelectorAll(".line")];
      lines.forEach(l=>l.classList.remove("show"));

      const btn = unlockBtnSel ? $(unlockBtnSel) : null;
      if(btn) lock(btn);

      let i=0;
      const step = ()=>{
        if(i < lines.length){
          lines[i].classList.add("show");
          i++;
          revealTimer = setTimeout(step, 520);
        }else{
          if(btn) unlock(btn);
        }
      };
      revealTimer = setTimeout(step, 220);
    }

    /* ====================== CH2 TYPING (PENGENNN üò§ + huft‚Ä¶) ====================== */
    function startPengenTyping(){
      const out = $("#pengenWord");
      const huft = $("#huft");
      const btn = $("#to5");
      out.textContent = "";
      huft.style.display = "none";
      lock(btn);

      const text = "PENGENNN üò§";
      let i=0;
      const type = ()=>{
        out.textContent += text[i] || "";
        i++;
        if(i < text.length){
          setTimeout(type, 110);
        }else{
          huft.style.display = "block";
          unlock(btn);
        }
      };
      setTimeout(type, 420);
    }

    /* ====================== CH3 TOK TOK 3x ====================== */
    let knocks = 0;
    function resetDoor(){
      knocks = 0;
      $("#knockCount").textContent = "0 / 3";
      const btn = $("#to7");
      lock(btn);

      const lines = [...$("#doorLines").querySelectorAll(".line")];
      lines.forEach(l=>l.classList.remove("show"));
    }

    $("#knock").addEventListener("click", ()=>{
      if(idx !== 6) return;
      knocks = Math.min(3, knocks + 1);
      $("#knockCount").textContent = `${knocks} / 3`;

      const lines = [...$("#doorLines").querySelectorAll(".line")];
      if(knocks === 1) lines[0].classList.add("show");
      if(knocks === 2) lines[1].classList.add("show");
      if(knocks === 3){
        lines[2].classList.add("show");
        lines[3].classList.add("show");
        unlock($("#to7"));
        showToast("tok tok ‚úÖ");
      }
    });

    /* ====================== CH4 TAP EYE ====================== */
    function resetMall(){
      $("#eyeDone").textContent = "belum";
      lock($("#to9"));
      const lines = [...$("#mallLines").querySelectorAll(".line")];
      lines.forEach(l=>l.classList.remove("show"));
    }

    $("#tapEye").addEventListener("click", ()=>{
      if(idx !== 8) return;
      $("#eyeDone").textContent = "udah";
      const lines = [...$("#mallLines").querySelectorAll(".line")];
      lines.forEach((l,k)=>setTimeout(()=>l.classList.add("show"), 220 + k*420));
      unlock($("#to9"));
      showToast("üëÄ");
    });

    /* ====================== CH5 HOLD 2s SAFE LINE ====================== */
    let holdTimer = null;
    let safeUnlocked = false;

    function resetSafeAndReveal(){
      safeUnlocked = false;
      $("#holdState").textContent = "tahan‚Ä¶";
      lock($("#to11"));

      // reveal fear lines automatically (no button)
      startAutoReveal("#fearLines", null);

      const safeLines = [...$("#safeLine").querySelectorAll(".line")];
      safeLines.forEach(l=>l.classList.remove("show"));
    }

    function startHold(){
      if(idx !== 10) return;
      if(safeUnlocked) return;
      $("#holdState").textContent = "‚Ä¶";
      holdTimer = setTimeout(()=>{
        safeUnlocked = true;
        $("#holdState").textContent = "ok";
        const safeLines = [...$("#safeLine").querySelectorAll(".line")];
        safeLines.forEach((l,k)=>setTimeout(()=>l.classList.add("show"), 120 + k*520));
        unlock($("#to11"));
        showToast("ü´∂");
      }, 2000);
    }
    function endHold(){
      clearTimeout(holdTimer);
      if(!safeUnlocked && idx === 10) $("#holdState").textContent = "tahan‚Ä¶";
    }

    $("#holdSafe").addEventListener("pointerdown", startHold);
    $("#holdSafe").addEventListener("pointerup", endHold);
    $("#holdSafe").addEventListener("pointerleave", endHold);
    $("#holdSafe").addEventListener("pointercancel", endHold);

    /* ====================== FINAL ENVELOPE + EASTER EGG ====================== */
    let envOpen = false;
    $("#env").addEventListener("click", ()=>{
      if(idx !== 13) return;
      if(envOpen) return;
      envOpen = true;
      $("#env").classList.add("open");
      setTimeout(()=>$("#letter").classList.add("show"), 650);
      showToast("üíå");
    });

    let flowerTaps = 0;
    $("#flower").addEventListener("click", ()=>{
      if(idx !== 13) return;
      flowerTaps = Math.min(7, flowerTaps + 1);
      $("#flowerCount").textContent = `${flowerTaps} / 7`;
      if(flowerTaps === 7){
        showToast("PS ü§ç");
        alert("PS: bau kamu bikin aku tentrem juga ü§ç");
      }
    });

    /* ====================== BUTTON NAV ====================== */
    $("#enter").addEventListener("click", ()=>go(1));

    $("#to2").addEventListener("click", ()=>{ if(!$("#to2").classList.contains("locked")) go(2); });
    $("#to3").addEventListener("click", ()=>{ if(!$("#to3").classList.contains("locked")) go(3); });
    $("#to4").addEventListener("click", ()=>{ if(!$("#to4").classList.contains("locked")) go(4); });
    $("#to5").addEventListener("click", ()=>{ if(!$("#to5").classList.contains("locked")) go(5); });
    $("#to6").addEventListener("click", ()=>{ if(!$("#to6").classList.contains("locked")) go(6); });
    $("#to7").addEventListener("click", ()=>{ if(!$("#to7").classList.contains("locked")) go(7); });
    $("#to8").addEventListener("click", ()=>{ if(!$("#to8").classList.contains("locked")) go(8); });
    $("#to9").addEventListener("click", ()=>{ if(!$("#to9").classList.contains("locked")) go(9); });
    $("#to10").addEventListener("click", ()=>{ if(!$("#to10").classList.contains("locked")) go(10); });
    $("#to11").addEventListener("click", ()=>{ if(!$("#to11").classList.contains("locked")) go(11); });
    $("#to12").addEventListener("click", ()=>{ if(!$("#to12").classList.contains("locked")) go(12); });
    $("#to13").addEventListener("click", ()=>{ if(!$("#to13").classList.contains("locked")) go(13); });

    $("#restart").addEventListener("click", ()=>{
      envOpen = false;
      $("#env").classList.remove("open");
      $("#letter").classList.remove("show");
      flowerTaps = 0;
      $("#flowerCount").textContent = "0 / 7";
      go(0);
    });

    $("#copyLink").addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText(location.href);
        showToast("Link copied ‚úÖ");
      }catch(e){
        showToast("Copy gagal");
      }
    });

    /* ====================== PHOTO CAROUSEL (must swipe unlock) ====================== */
    // Adjust counts here if you have more photos per chapter.
    const photoSets = {
      car1: ["c1-1.jpg","c1-2.jpg","c1-3.jpg","c1-4.jpg","c1-5.jpg"],
      car2: ["c2-1.jpg","c2-2.jpg","c2-3.jpg","c2-4.jpg"],
      car3: ["c3-1.jpg","c3-2.jpg","c3-3.jpg","c3-4.jpg"],
      car4: ["c4-1.jpg","c4-2.jpg","c4-3.jpg","c4-4.jpg"],
      car5: ["c5-1.jpg","c5-2.jpg","c5-3.jpg","c5-4.jpg"],
      car6: ["c6-1.jpg","c6-2.jpg","c6-3.jpg","c6-4.jpg"],
    };

    const pagerMap = {
      car1:"pg1", car2:"pg2", car3:"pg3", car4:"pg4", car5:"pg5", car6:"pg6"
    };

    const unlockMap = {
      car1:"#to2",
      car2:"#to4",
      car3:"#to6",
      car4:"#to8",
      car5:"#to10",
      car6:"#to12",
    };

    function buildCarousel(carId){
      const car = document.getElementById(carId);
      const pg = document.getElementById(pagerMap[carId]);
      const files = photoSets[carId] || [];
      car.innerHTML = "";
      pg.innerHTML = "";

      // build slides for existing files only (skip missing via onerror)
      const dots = [];
      files.forEach((src, i)=>{
        const slide = document.createElement("div");
        slide.className = "slide";
        slide.style.setProperty("--rot", (-1.4 + Math.random()*2.8).toFixed(2) + "deg");
        slide.style.setProperty("--rot2", (-1.4 + Math.random()*2.8).toFixed(2) + "deg");

        const img = document.createElement("img");
        img.alt = "";
        img.src = src;
        img.onerror = ()=> slide.remove(); // missing file -> remove slide
        slide.appendChild(img);
        car.appendChild(slide);

        const d = document.createElement("div");
        d.className = "dotp" + (i===0 ? " on" : "");
        pg.appendChild(d);
        dots.push(d);
      });

      // must swipe logic
      let swiped = false;
      const unlockBtn = document.querySelector(unlockMap[carId]);
      if(unlockBtn) lock(unlockBtn);

      function updateDots(){
        const children = [...car.children];
        if(children.length === 0) return;
        const center = car.scrollLeft + car.clientWidth/2;
        let bestI = 0;
        let bestDist = Infinity;
        children.forEach((el, i)=>{
          const elCenter = el.offsetLeft + el.clientWidth/2;
          const dist = Math.abs(elCenter - center);
          if(dist < bestDist){ bestDist = dist; bestI = i; }
        });
        dots.forEach((d, i)=> d.classList.toggle("on", i===bestI));
      }

      car.addEventListener("scroll", ()=>{
        updateDots();
        // ‚Äúswipe minimal 1x‚Äù = scrollLeft passes a small threshold
        if(!swiped && car.scrollLeft > 18){
          swiped = true;
          if(unlockBtn) unlock(unlockBtn);
        }
      });

      // if only 1 slide remains, allow unlock without forcing swipe
      setTimeout(()=>{
        if(car.children.length <= 1){
          if(unlockBtn) unlock(unlockBtn);
        }
        updateDots();
      }, 250);
    }

    Object.keys(photoSets).forEach(buildCarousel);

    /* ====================== PETALS CANVAS ====================== */
    const canvas = document.getElementById("petals");
    const ctx = canvas.getContext("2d");
    let W,H,petals=[];
    function resize(){
      W = canvas.width = window.innerWidth * devicePixelRatio;
      H = canvas.height = window.innerHeight * devicePixelRatio;
    }
    window.addEventListener("resize", resize); resize();

    function makePetal(){
      const colors = [
        "rgba(246,193,216,.35)",
        "rgba(243,229,200,.28)",
        "rgba(157,175,157,.22)"
      ];
      return {
        x: Math.random()*W,
        y: -Math.random()*H,
        r: (2 + Math.random()*4) * devicePixelRatio,
        vx: (-0.22 + Math.random()*0.44) * devicePixelRatio,
        vy: (0.35 + Math.random()*0.9) * devicePixelRatio,
        rot: Math.random()*Math.PI,
        vr: (-0.02 + Math.random()*0.04),
        c: colors[Math.floor(Math.random()*colors.length)]
      };
    }
    for(let i=0;i<52;i++) petals.push(makePetal());

    function drawPetal(p){
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.c;
      ctx.beginPath();
      ctx.ellipse(0,0,p.r*1.4,p.r,0,0,Math.PI*2);
      ctx.fill();
      ctx.restore();
    }

    function loop(){
      ctx.clearRect(0,0,W,H);
      for(const p of petals){
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;

        if(p.y > H + 20) { p.y = -20; p.x = Math.random()*W; }
        if(p.x < -40) p.x = W + 40;
        if(p.x > W + 40) p.x = -40;

        drawPetal(p);
      }
      requestAnimationFrame(loop);
    }
    loop();

    /* ====================== INIT LOCKS + FIRST TINT ====================== */
    // lock nav buttons that require interactions
    ["#to2","#to3","#to4","#to5","#to6","#to7","#to8","#to9","#to10","#to11","#to12","#to13"].forEach(sel=>{
      const b = $(sel);
      if(b) lock(b);
    });
    setPaperTint(...tints[0]);
  </script>
</body>
</html>
